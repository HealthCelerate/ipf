
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>HL7v2 Message Validation | ipf-modules-hl7</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-hl7v2validation project-ipf-modules-hl7" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="HL7v2_Message_Validation">HL7v2 Message Validation</h2>
 </div> 
 <div class="section"> 
  <h3 id="Overview">Overview</h3> 
  <p>HL7v2 is a complex flat-file structure that, despite being considered a data standard, is also highly flexible. It is often expected of an HL7 integration engine that non-standard compliant data be accepted and processed without notification to the receiving system of non-compliance.</p> 
  <p>However, to achieve real interoperability, the HL7 standard should be constrained to reduce the degree of freedom, e.g. how to use certain fields or whether to populate optional fields or not. This happens either based on a written specification or in addition as machine-readble conformance profile.</p> 
  <p>In order to check whether HL7 messages actually conform to the defined constraints, message validation is essential.</p> 
  <p><b>Note</b>: the <a class="externalLink" href="http://hl7api.sourceforge.net">HAPI</a> library already offers support for validating HL7 messages by definition of rules that check against constraints on type level, message level, and encoded message level. Recent versions of <a class="externalLink" href="http://hl7api.sourceforge.net">HAPI</a> provide much easier ways of specifying validation rules than before, so IPF 3 has removed or deprecated a lot of its custom validation rule builders. For details refer e.g. to the [HAPI Examples].</p> 
  <p>IPF 3 continues to support the definition of custom validation rules that exploiting features of the Groovy language already being used in other parts of IPF.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Abstract_Syntax_message_rule">Abstract Syntax message rule</h3> 
  <p>HL7 v2 defines an Abstract Message Syntax (see HL7v2.5 specification, Chapter 2.13), that determines how groups and segments are expected for a specific message type. Cardinality is indicated by using</p> 
  <ul> 
   <li>brackets (<tt>[...]</tt>) for optional groups or segments, i.e. <tt>[0..1]</tt></li> 
   <li>braces (<tt>{...}</tt>) for repeatable groups or segments, i.e. <tt>[1..*]</tt></li> 
   <li>a combination of both (<tt>{[...]}</tt> or <tt>[{...}]</tt>) for optional and repeatable groups or segments, i.e. <tt>[0..*]</tt></li> 
  </ul> 
  <p>IPF provides support for checking a message instance against such an Abstract Message Syntax definition with the <tt>abstractSyntax</tt> builder expression. The corresponding rule is almost a copy of the definition, with only a few differences:</p> 
  <ul> 
   <li>segment names are enclosed in single quotes</li> 
   <li>group names are specified like function calls inside the cardinality indicators as described above</li> 
   <li>a choice of one segment from a group of segments is currently not supported.</li> 
  </ul> 
  <p>Note that fields inside segments can neither be specified nor validated with the Abstract Message Syntax.</p> 
  <div class="section"> 
   <h4 id="Example">Example</h4> 
   <p>HL7 Abstract Message Syntax Definition:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>MSH
[  {  SFT  }  ]
                              PATIENT_RESULT
                              PATIENT
{  [  PID
      [  PD1  ]
      [  {  NTE  }  ]
      [  {  NK1  }  ]
                              VISIT
      [  PV1
         [  PV2  ]
      ]
                              VISIT
   ]
                              PATIENT
                              ORDER_OBSERVATION
   {  [  ORC  ]
      OBR
      [  {  NTE  }  ]
                              TIMING_QTY
      [{  TQ1
         [  {  TQ2  }  ]
      }]
                              TIMING_QTY
      [  CTD  ]
                              OBSERVATION
      [{  OBX
         [  {  NTE  } ]
      }]
                              OBSERVATION
      [  {  FT1  }  ]
      [  {  CTI  }  ]
                              SPECIMEN
      [{  SPM
         [  {  OBX  }  ]
      }]
                              SPECIMEN
   }
                              ORDER_OBSERVATION
}
                              PATIENT_RESULT
[  DSC  ]
</pre> 
    </div> 
   </div> 
   <p>Corresponding IPF Validation Rule:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    import ca.uhn.hl7v2.validation.builder.support.NoValidationBuilder

    public class SampleRulesBuilder extends NoValidationBuilder {

        @Override
        protected void configure() {
            super.configure()

           forVersion(Version.V25)
              .message('ORU', 'R01').abstractSyntax(
                  'MSH',
                  [  {  'SFT'  }  ],
                  {PATIENT_RESULT(
                     [PATIENT(
                        'PID',
                        [  'PD1'  ],
                        [  {  'NTE'  }  ],
                        [  {  'NK1'  }  ],
                        [VISIT(
                           'PV1',
                           [  'PV2'  ]
                       )]
                     )],
                     {ORDER_OBSERVATION(
                        [  'ORC'  ],
                         'OBR',
                         [{  'NTE'  }],
                         [{TIMING_QTY(
                            'TQ1',
                            [{  'TQ2'  }]
                         )}],

                         [  'CTD'  ],
                         [{OBSERVATION(
                            'OBX',
                            [  {  'NTE'  }  ]
                         )}],

                         [{  'FT1'  }],
                         [{  'CTI'  }],
                         [{SPECIMEN(
                            'SPM',
                            [{  'OBX'  }]
                         )}]
                      )}
                   )},
                   [ 'DSC' ]
                )
        }
    }
</pre> 
    </div> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Closure_rules">Closure rules</h3> 
  <p>You can use rules also to program you own custom constraints on one or more trigger events. All there is to do is to write a <tt>checkIf</tt> closure that returns an array of <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/ValidationException.html"><tt>ValidationException</tt></a> objects. If the array is empty, validation is considered passed.</p> 
  <div class="section"> 
   <h4 id="Example">Example</h4> 
   <p>The following example defines a few closure-based rules for primitive types, pasred and encoded messages.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    import ca.uhn.hl7v2.validation.builder.support.NoValidationBuilder

    public class ClosureRulesBuilder extends NoValidationBuilder {

        @Override
        protected void configure() {
            super.configure()

           forVersion().asOf(Version.V23)
              .primitive(&quot;ID&quot;, &quot;IS&quot;).checkIf { String value -&gt;
                  value.size() &lt; 200 ? passed() : failed(&quot;too long!&quot;)
              }
              .message('ADT', '*').checkIf { Message msg -&gt;
                  // validate the message
              }
        }
    }

</pre> 
    </div> 
   </div> 
  </div> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#HL7v2_Message_Validation" title="HL7v2 Message Validation">HL7v2 Message Validation <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Overview" title="Overview">Overview</a>
		<li class="dropdown"><a href="#Abstract_Syntax_message_rule" title="Abstract Syntax message rule">Abstract Syntax message rule <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Example" title="Example">Example</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Closure_rules" title="Closure rules">Closure rules <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Example" title="Example">Example</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Submodules</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
