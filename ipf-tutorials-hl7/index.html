
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>HL7 Support Tutorial | ipf-tutorials-hl7</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/css/docs.css" rel="stylesheet" />
		<link href="/css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="/css/lightbox.css" rel="stylesheet" />

		<link href="/css/site.css" rel="stylesheet" />
		<link href="/css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-index project-ipf-tutorials-hl7" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-tutorials/ipf-platform-camel-ihe/index.html" title="eHealth Integration Profiles">eHealth Integration Profiles</a></li>
									<li ><a href="../ipf-tutorials/ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-tutorials/ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../ipf-tutorials/dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-tutorials/ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="HL7_Support_Tutorial">HL7 Support Tutorial</h2>
 </div> 
 <p>This tutorial guides you through an HL7 version 2 message processing example.</p> 
 <div class="section"> 
  <h3 id="Subject_of_this_tutorial">Subject of this tutorial</h3> 
  <p>We will create an IPF application that reads an HL7 v2 message from a file endpoint, validates and transforms the message, and writes the transformation result to an output file. Message processing is done via IPF’s HL7 DSL and via HL7-specific extensions to the Camel DSL.</p> 
  <div class="section"> 
   <h4 id="Validation">Validation</h4> 
   <p>The message is an ADT A01 message, version 2.2, and we want to enforce that</p> 
   <ul> 
    <li>all primitive type values have the correct format and</li> 
    <li>the message itself contains a defined sequence of segments</li> 
   </ul> 
  </div> 
  <div class="section"> 
   <h4 id="Transformation">Transformation</h4> 
   <p>Now lets look the transformation we want to perform if we passed validation.</p> 
   <ul> 
    <li>The room number and bed number from the <tt>PV1[3]</tt> field shall be dropped. This field is a composite field and we want to drop the second and the third component.</li> 
    <li>The birth date in <tt>PID[7]</tt> shall be reformatted by dropping the last 6 digits. This field is also a composite field with only a single component.</li> 
    <li>The gender code in <tt>PID[8]</tt> shall be mapped to a code from another code system. We will use a simple code mapping service for that.</li> 
   </ul> 
   <p>Finally, we will derive the destination file name from the <tt>MSH[4]</tt> field (sending facility).</p> 
   <p><img src="images/tutorial-hl7-01.JPG" alt="HL7 Message" /></p> 
  </div> 
  <div class="section"> 
   <h4 id="Route_Design">Route Design</h4> 
   <p>Here’s the order in which the message will be processed:</p> 
   <ul> 
    <li>An HL7 message is received via a file endpoint.</li> 
    <li>The message is validated as described above.</li> 
    <li>The message is forwarded to a transformer that makes the changes to the HL7 message as described above.</li> 
    <li>The transformation result is placed into different files whose names are derived from the <tt>MSH[4]</tt> field.</li> 
   </ul> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Create_the_Project">Create the Project</h3> 
  <p>Create an IPF example project using the basic IPF Maven archetype:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>mvn org.apache.maven.plugins:maven-archetype-plugin:2.0-alpha-4:generate
 -DarchetypeGroupId=org.openehealth.ipf.archetypes
 -DarchetypeArtifactId=ipf-archetype-basic
 -DarchetypeVersion=3.0.0
 -DgroupId=org.openehealth.tutorial
 -DartifactId=hl7
 -Dversion=1.0-SNAPSHOT
 -DinteractiveMode=false
</pre> 
   </div> 
  </div> 
  <p>This will create a folder named <tt>hl7</tt> in the current directory. Change to this directory and build the project:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>mvn clean install
</pre> 
   </div> 
  </div> 
  <p>This will build the project and install the project artifacts into your local Maven cache. You can also import the project into your favorite IDE.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Extend_the_project_descriptor">Extend the project descriptor</h3> 
  <p>In order to enable <a href="../ipf-platform-camel-hl7/index.html">HL7 processing</a> we have to include further dependencies into the Maven project descriptor <tt>pom.xml</tt>.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.openehealth.ipf.platform-camel&lt;/groupId&gt;
            &lt;artifactId&gt;ipf-platform-camel-hl7&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.openehealth.ipf.commons&lt;/groupId&gt;
            &lt;artifactId&gt;ipf-commons-spring&lt;/artifactId&gt;
        &lt;/dependency&gt;        
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-groovy&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ca.uhn.hapi&lt;/groupId&gt;
            &lt;artifactId&gt;hapi-structures-v22&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ca.uhn.hapi&lt;/groupId&gt;
            &lt;artifactId&gt;hapi-structures-v23&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ca.uhn.hapi&lt;/groupId&gt;
            &lt;artifactId&gt;hapi-structures-v25&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;log4j&lt;/groupId&gt;
            &lt;artifactId&gt;log4j&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Extend_the_application_context">Extend the application context</h3> 
  <p>The components included in the previous section must also be configured in the Spring application <tt>context.xml</tt> file. This file is located under <tt>src/main/resources</tt>. In addition to the default configuration created by the archetype we need to</p> 
  <ul> 
   <li>configure a mapping service that we will use for code mappings</li> 
   <li>add a <a class="externalLink" href="http://hl7api.sourceforge.net/base/apidocs/ca/uhn/hl7v2/validation/builder/ValidationRuleBuilder.html">ValidationRuleBuilder</a> bean for HL7 validation</li> 
  </ul> 
  <div class="source"> 
   <div class="source"> 
    <pre>    &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
           xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
           xmlns:camel=&quot;http://camel.apache.org/schema/spring&quot;
           xmlns:ipf=&quot;http://openehealth.org/schema/ipf-commons-core&quot;
           xsi:schemaLocation=&quot;
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://camel.apache.org/schema/spring
    http://camel.apache.org/schema/spring/camel-spring.xsd
    http://openehealth.org/schema/ipf-commons-core
    http://openehealth.org/schema/ipf-commons-core.xsd&quot;&gt;

        &lt;camel:camelContext id=&quot;camelContext&quot;&gt;
            &lt;camel:jmxAgent id=&quot;agent&quot; disabled=&quot;true&quot; /&gt;
            &lt;camel:routeBuilder ref=&quot;routeBuilder&quot;/&gt;
        &lt;/camel:camelContext&gt;

        &lt;bean id=&quot;routeBuilder&quot; class=&quot;org.openehealth.ipf.tutorials.hl7.route.SampleRouteBuilder&quot;/&gt;

        &lt;!-- Registers this Spring context as the one to look up the mapping service --&gt;
        &lt;ipf:globalContext id=&quot;globalContext&quot;/&gt;

        &lt;bean id=&quot;mappingService&quot;
            class=&quot;org.openehealth.ipf.commons.map.SpringBidiMappingService&quot;&gt;
            &lt;property name=&quot;mappingResource&quot; value=&quot;classpath:tutorial.map&quot;/&gt;
        &lt;/bean&gt;

        &lt;bean id=&quot;myCustomRules&quot; class=&quot;org.openehealth.ipf.tutorials.hl7.validation.SampleRulesBuilder&quot;/&gt;

    &lt;/beans&gt;
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Route_Definition">Route Definition</h3> 
  <p>Let’s start with an overview of the complete route. Open the <tt>SampleRouteBuilder.groovy</tt> file and replace the existing routes in the <tt>configure()</tt> method:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    package org.openehealth.ipf.tutorials.hl7.route

    import ca.uhn.hl7v2.DefaultHapiContext
    import ca.uhn.hl7v2.HapiContext
    import org.apache.camel.Exchange
    import org.apache.camel.component.hl7.HL7DataFormat
    import org.apache.camel.spring.SpringRouteBuilder
    import org.openehealth.ipf.tutorials.hl7.validation.SampleRulesBuilder

    import static org.apache.camel.component.hl7.HL7.messageConforms


    public class SampleRouteBuilder extends SpringRouteBuilder {

        void configure() {

            // Set up HL7 context with the custom validation rules and disable validation during parsing
            HapiContext context = new DefaultHapiContext(lookup(SampleRulesBuilder))
            context.getParserConfiguration().setValidating(false)

            // Set up Camel HL7 Data format using the HapiContext defined above
            HL7DataFormat hl7 = new HL7DataFormat()
            hl7.setHapiContext(context)

            // Read file from directory and forward to direct endpoint
            from('file:target/input')
                    .convertBodyTo(String)
                    .to('direct:input')

            // Main processing: parse message, validate, transform
            from('direct:input')
                    .unmarshal(hl7)
                    // validate that the message conforms to the rules defined in the HapiContext
                    .validate(messageConforms())
                    .transmogrify { msg -&gt;
                        msg.PV1[3][2] = '' // clear room nr.
                        msg.PV1[3][3] = '' // clear bed nr.
                        msg.PID[7][1] = msg.PID[7][1].value.substring(0, 8) // format birth date
                        msg.PID[8] = msg.PID[8].mapGender()                 // map gender
                        msg
                    }

                    // Set header so Camel knows the file to write into
                    .setHeader(Exchange.FILE_NAME) { exchange -&gt;
                        exchange.in.body.MSH[4].value + '.hl7'
                    }

                    // Convert message to string and write to file
                    .convertBodyTo(String)
                    .to('file:target/output')
        }
    }

</pre> 
   </div> 
  </div> 
  <p>In the route we refer to a <tt>SampleRulesBuilder</tt> validation class that defines the allowed sequence and cardinalities of HL7 groups and segments for this message. The file must be added to the <tt>src/main/groovy</tt> directory in the subdirectory <tt>org/openehealth/tutorial</tt>:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    package org.openehealth.tutorial

    import org.openehealth.ipf.modules.hl7.validation.DefaultValidationContext
    import org.openehealth.ipf.modules.hl7.validation.builder.RuleBuilder
    import org.openehealth.ipf.modules.hl7.validation.builder.ValidationContextBuilder

    class SampleRulesBuilder extends ValidationContextBuilder {

        // We define only a subset of the segments defined in the HL7 2.2 spec

        public RuleBuilder forContext(DefaultValidationContext context) {
            new RuleBuilder(context)
              .forVersion('2.2')
                .message('ADT', 'A01').abstractSyntax(
                        'MSH',
                        'EVN',
                        'PID',
                        [  {  'NK1'  }  ],
                        'PV1',
                        [  {  INSURANCE(
                                  'IN1',
                                  [  'IN2'  ] ,
                                  [  'IN3'  ]
                        )}]
                )
        }
    }

</pre> 
   </div> 
  </div> 
  <p>The sequence and cardinality of groups and segments is defined in a syntax that is very closely related to the HL7 Abstract Message Syntax. The message is required to contain a <tt>MSH</tt>, <tt>EVN</tt>, <tt>PID</tt> and <tt>PV1</tt> segment; it may contain any number of <tt>NK1</tt> segments and it may contain a repeatable <tt>INSURANCE</tt> group. For detail, please read the documentation on <a href="../ipf-modules-hl7/hl7v2validation.html">HL7 validation</a>.</p> 
  <p>As our test message matches this definition, we expect the message to pass validation.</p> 
  <p>The transformation is implemented using a <a href="../ipf-platform-camel-core/index.html">Transmogrifier</a> closure. Inside the closure we use the <a href="../ipf-modules-hl7/hl7v2dsl.html">HL7 DSL</a> in order to manipulate the message context.</p> 
  <p>The HL7 DSL allows us to do this without dealing with low level HL7 API details. You immediately see how the message is processed by looking at the code.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>...
    .transmogrify { msg -&gt;
        msg.PV1[3][2] = '' // clear room nr.
        msg.PV1[3][3] = '' // clear bed nr.
        msg.PID[7][1] = msg.PID[7][1].value.substring(0, 8) // format birth date
        msg.PID[8] = msg.PID[8].mapGender()                 // map gender
        msg
    }
</pre> 
   </div> 
  </div> 
  <p>For accessing a message segment, directly use the segment name like <tt>msg.PV1</tt> or <tt>msg.PID</tt>. Fields and sub-fields (components of a composite field) are accessed by indices starting from 1. For example, <tt>PV1[3][2]</tt> denotes the second component of the third PV1 field. For a complete reference of the HL7 DSL refer to the <a href="../ipf-modules-hl7/hl7v2dsl.html">HL7 DSL</a> documentation.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Code_Mapping">Code Mapping</h3> 
  <p>Code mapping is done with the <tt>mapGender()</tt> method. This method translates the English ‘F’ code (female) contained in <tt>PID[8]</tt> to a German ‘W’ code (weiblich).</p> 
  <p>The application context configures the code mapping service to use a mappingScript named <tt>tutorial-hl7.map</tt>. In our example, we only need a single gender mapping table an entry that maps ‘F’ to ‘W’ and one entry that leaves all other codes unchanged.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    mappings = {
      gender(
        F      : 'W',
        (ELSE) : { it }
      )
    }
</pre> 
   </div> 
  </div> 
  <p>This format is valid Groovy syntax and is understood by the default bi-directional mapping service provided by IPF. For a complete reference refer to the <a href="../ipf-commons-map/index.html">mapping service</a> section of documentation.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Automated_Route_Testing">Automated Route Testing</h3> 
  <p>For automated testing we will use the following HL7 message:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>MSH|^~\&amp;|SAP-ISH|HZL|||20040805152637||ADT^A01|123456|T|2.2|||ER
EVN|A01|20040805152637
PID|1||79471||Meier^Elfriede|Meier|19400101000000|F|||Hauptstrasse 23^^Essen^NW^11000^DE^H|||||S|||111-11-1111||||Essen
NK1|1|Meier^Elfriede|EMC|Hauptstrasse 23^^Essen^NW^11000^DE|333-4444~333-5555|
PV1|1|I|ISKA^13^4|R||||823745217||||||||N|||79237645|||||||||||||||||||||||||20040805000000
</pre> 
   </div> 
  </div> 
  <p>After processing we expect the following output:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>MSH|^~\&amp;|SAP-ISH|HZL|||20040805152637||ADT^A01|123456|T|2.2|||ER
EVN|A01|20040805152637
PID|1||79471||Meier^Elfriede|Meier|19400101|W|||Hauptstrasse 23^^Essen^NW^11000^DE^H|||||S|||111-11-1111||||Essen
NK1|1|Meier^Elfriede|EMC|Hauptstrasse 23^^Essen^NW^11000^DE|333-4444~333-5555|
PV1|1|I|ISKA|R||||823745217||||||||N|||79237645|||||||||||||||||||||||||20040805000000
</pre> 
   </div> 
  </div> 
  <p>Create two files, <tt>msg-01.hl7</tt> and <tt>msg-01.hl7.expected</tt>, with the above content under the <tt>src/test/resources</tt> folder. These files will be used inside our JUnit test. To implement the test open the <tt>SampleRouteTest.java</tt> file and replace its content with the following:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    package org.openehealth.ipf.tutorials.hl7.route;

    import java.io.InputStream;
    import java.util.Scanner;

    import ca.uhn.hl7v2.HL7Exception;
    import ca.uhn.hl7v2.model.Message;
    import ca.uhn.hl7v2.parser.PipeParser;
    import org.apache.camel.ProducerTemplate;
    import org.junit.After;
    import org.junit.Before;
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.core.io.FileSystemResource;
    import org.springframework.test.context.ContextConfiguration;
    import org.springframework.test.context.TestExecutionListeners;
    import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
    import org.springframework.test.context.support.DependencyInjectionTestExecutionListener;

    import static org.junit.Assert.assertEquals;

    @RunWith(SpringJUnit4ClassRunner.class)
    @TestExecutionListeners({DependencyInjectionTestExecutionListener.class})
    @ContextConfiguration(locations = { &quot;/context.xml&quot; })
    public class SampleRouteTest {

        @Autowired
        private ProducerTemplate producerTemplate;

        @Test
        public void testRoute() throws Exception {
            producerTemplate.sendBody(&quot;direct:input&quot;, getClass().getResourceAsStream(&quot;/msg-01.hl7&quot;));
            Resource result = new FileSystemResource(&quot;target/output/HZL.hl7&quot;);
            assertEquals(
                    load(getClass().getResourceAsStream(&quot;/msg-01.hl7.expected&quot;)).toString(),
                    load(result.getInputStream()).toString());
        }

        // Helper method to load and parse a HL7v2 message from a file
        protected static &lt;T extends Message&gt; T load(InputStream is) throws HL7Exception {
            return (T)new PipeParser().parse(
                    new Scanner(is).useDelimiter(&quot;\\A&quot;).next());
        }
    }

</pre> 
   </div> 
  </div> 
  <p>The <tt>testRoute</tt> method opens an <tt>InputStream</tt> on the input file and sends that stream in the in-message body to the <tt>direct:input</tt> endpoint. The processing result is loaded from the created <tt>HZL.hl7</tt> file and compared with the expected processing result.</p> 
  <p>Execute the test in your IDE or run <tt>mvn test</tt> one the command line.</p> 
  <p>The test should successfully execute and you should also see an HZL.hl7 file in the <tt>target/output</tt> directory containing the processing result.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Assembly_and_Installation">Assembly and Installation</h3> 
  <p>We finally want to create a distribution package from our project, install (unzip) that package somewhere and start a standalone integration server (i.e. an integration server that runs outside your IDE). To create the package enter on the command line:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>mvn assembly:assembly
</pre> 
   </div> 
  </div> 
  <p>The created package <tt>hl7-1.0-SNAPSHOT-bin.zip</tt> is written to the project’s target folder. Copy the package to a new location and unzip it. This will create a folder named <tt>hl7-1.0-SNAPSHOT</tt> with the following content:</p> 
  <p><img src="images/tutorial-hl7-03.JPG" alt="distro" /></p> 
  <ul> 
   <li>The <tt>lib</tt> folder contains the project jar file (<tt>hl7-1.0-SNAPSHOT.jar</tt>) as well as all required runtime dependencies.</li> 
   <li>The <tt>conf</tt> folder contains a <tt>log4j.xml</tt> configuration file.</li> 
   <li>Startup scripts are located directly under the root folder.</li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="Starting_the_server">Starting the server</h3> 
  <p>The way how the project is packaged can of course be customized by changing the project’s <tt>src/main/assembly/bin.xml</tt> assembly descriptor. The script startup.sh is currently empty i.e. for testing-purposes you have to run the server on Windows using <tt>startup.bat</tt>:</p> 
  <p><img src="images/console.png" alt="Console" /></p> 
  <p>Finally, copy the test HL7v2 message <tt>msg-01.hl7</tt> into the <tt>target/input</tt> folder and wait a few seconds. The file is consumed and the transformed result is written into the <tt>target/output</tt> folder.</p> 
  <p>Enter <tt>Ctrl-C</tt> in the console to stop the server.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Summary">Summary</h3> 
  <p>In this tutorial, we:</p> 
  <ul> 
   <li>created a Maven-based IPF project</li> 
   <li>added IPF dependencies relevant for HL7 processing</li> 
   <li>created a Camel route that reads, parses, validates, transforms, and renders a HL7 message</li> 
   <li>executed a unit test that verified the process</li> 
   <li>assembled a distribution containing a server executing the code</li> 
   <li>tested the running server with an example HL7 message</li> 
  </ul> 
  <p>The source code for this tutorial is located in the <a class="externalLink" href="https://github.com/oehf/ipf/tree/master/tutorials/hl7">ipf-tutorials-hl7</a> module.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#HL7_Support_Tutorial" title="HL7 Support Tutorial">HL7 Support Tutorial <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#Subject_of_this_tutorial" title="Subject of this tutorial">Subject of this tutorial <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Validation" title="Validation">Validation</a>
		<li><a href="#Transformation" title="Transformation">Transformation</a>
		<li><a href="#Route_Design" title="Route Design">Route Design</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Create_the_Project" title="Create the Project">Create the Project</a>
		<li><a href="#Extend_the_project_descriptor" title="Extend the project descriptor">Extend the project descriptor</a>
		<li><a href="#Extend_the_application_context" title="Extend the application context">Extend the application context</a>
		<li><a href="#Route_Definition" title="Route Definition">Route Definition</a>
		<li><a href="#Code_Mapping" title="Code Mapping">Code Mapping</a>
		<li><a href="#Automated_Route_Testing" title="Automated Route Testing">Automated Route Testing</a>
		<li><a href="#Assembly_and_Installation" title="Assembly and Installation">Assembly and Installation</a>
		<li><a href="#Starting_the_server" title="Starting the server">Starting the server</a>
		<li><a href="#Summary" title="Summary">Summary</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
						<li class="nav-header">Main</li>
						<li >
							<a href="../ipf-tutorials/" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../ipf-tutorials/release-notes.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Download</li>
						<li >
							<a href="../ipf-tutorials/skin/index.html#Usage" title="Download">Download</a>
						</li>
						<li >
							<a href="../ipf-tutorials/license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../ipf-tutorials/development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-ihe/index.html" title="eHealth Integration Profiles">eHealth Integration Profiles</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../ipf-tutorials/dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven documentation</li>
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li class="active">
							<a href="#" title="About">About</a>
						</li>
						<li >
							<a href="project-summary.html" title="Summary">Summary</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
						<li >
							<a href="dependencies.html" title="Dependencies">Dependencies</a>
						</li>
						<li >
							<a href="license.html" title="Licenses">Licenses</a>
						</li>
						<li >
							<a href="mail-lists.html" title="Mailing Lists">Mailing Lists</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source Code Management">Source Code Management</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="/js/lightbox.min.js"></script>
	<script src="/js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="/js/reflow-skin.js"></script>

	</body>
</html>
