
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>XDS demo repository | ipf-tutorials-xds</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/css/docs.css" rel="stylesheet" />
		<link href="/css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="/css/lightbox.css" rel="stylesheet" />

		<link href="/css/site.css" rel="stylesheet" />
		<link href="/css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-index project-ipf-tutorials-xds" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-tutorials/ipf-platform-camel-ihe/index.html" title="eHealth Integration Profiles">eHealth Integration Profiles</a></li>
									<li ><a href="../ipf-tutorials/ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-tutorials/ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-tutorials/ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../ipf-tutorials/dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-tutorials/ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="XDS_demo_repository">XDS demo repository</h2>
 </div> 
 <p>This tutorial is a guide to the XDS demo repository, a simplified implementation of an XDS registry and repository to store documents, folders, submission sets and associations. The demo is useful for everyone who wants to use the IPF XDS components.</p> 
 <p>It shows how to:</p> 
 <ul> 
  <li>Use the XDS.b components to offer a registry and a repository service</li> 
  <li>Transform and process registration, retrieval and query requests</li> 
  <li>Configure and use ATNA logging</li> 
  <li>Enable secure transport using HTTPS</li> 
 </ul> 
 <p>The demo repository is non-persistent. A restart will therefore always start out with a blank respository/registry.</p> 
 <div class="section"> 
  <h3 id="Overview">Overview</h3> 
  <p>The XDS demo repository is implemented in Groovy. Most of the code deals with the query functionality. This is used for the ITI-18 transaction (registry stored query) and for the other transactions to perform checks of the input data. Within the project you can find the following source files, tests and configuration files:</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Source file </th> 
     <th>Responsibility</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td>DataStore </td> 
     <td>The actual storage of documents, document entries, folders, submission sets and associations. The store is non-persistent at the moment to keep things simple. Allows adding, retrieving and querying</td> 
    </tr> 
    <tr class="a"> 
     <td>Comparators </td> 
     <td>Basic comparison methods used by the query logic</td> 
    </tr> 
    <tr class="b"> 
     <td>ContentUtils </td> 
     <td>Helpers to calculate content related data, e.g. hash codes and size</td> 
    </tr> 
    <tr class="a"> 
     <td>Iti18RouteBuilder </td> 
     <td>Route for the stored query transaction</td> 
    </tr> 
    <tr class="b"> 
     <td>Iti4142RouteBuilder </td> 
     <td>Routes for the register document set transactions</td> 
    </tr> 
    <tr class="a"> 
     <td>Iti43RouteBuilder </td> 
     <td>Route for the retrieve document set transaction</td> 
    </tr> 
    <tr class="b"> 
     <td>QueryMatcher </td> 
     <td>Matching code for various stored query types used by ITI-18</td> 
    </tr> 
    <tr class="a"> 
     <td>RegRepModelExtension </td> 
     <td>The DSL extension for the routes</td> 
    </tr> 
    <tr class="b"> 
     <td>SearchDefinition </td> 
     <td>The DSL element for creating a search query in a route</td> 
    </tr> 
    <tr class="a"> 
     <td>SearchProcessor </td> 
     <td>The processor that performs search queries using the data store</td> 
    </tr> 
    <tr class="b"> 
     <td>SearchResult </td> 
     <td>An enum that represents the type of results from a search query</td> 
    </tr> 
    <tr class="a"> 
     <td>Server </td> 
     <td>The main entry point of the demo repository that starts the server</td> 
    </tr> 
   </tbody> 
  </table> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Test file </th> 
     <th>Responsibility</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td>TestRepositoryAndRegistry</td> 
     <td>Basic tests that send individual requests and check their results</td> 
    </tr> 
    <tr class="a"> 
     <td>TestThreading </td> 
     <td>A multi-threading test to show the thread-safety of the repository and of the XDS components</td> 
    </tr> 
    <tr class="b"> 
     <td>ContentUtils </td> 
     <td>Base class for tasks used in the multi-threading test</td> 
    </tr> 
   </tbody> 
  </table> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Config file </th> 
     <th>Responsibility</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td>context.xml </td> 
     <td>Spring application context containing beans for Camel and IPF configuration as well as the data store</td> 
    </tr> 
    <tr class="a"> 
     <td>log4j.xml, logging.properties </td> 
     <td>logging configuration</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>The repository can be started within your IDE or from command line using the <tt>startup.bat</tt> after building an assembly.</p> 
  <p>For this guide it is assumed that you have installed the Groovy Eclipse plugin as described in our development setup. To start the server within Eclipse, right click on Server.groovy and choose Run as/Groovy.</p> 
  <p>The repository can be configured to use HTTPS by specifying the command line argument <tt>secure</tt>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="IPF_XDS_related_code_snippets">IPF XDS related code snippets</h3> 
  <p>The main purpose of the demo repository is to demonstrate the features that the IPF XDS Camel components offer. This section takes a closer look at such code pieces.</p> 
  <div class="section"> 
   <h4 id="Basic_Configuration">Basic Configuration</h4> 
   <p>Configuration of an XDS application is pretty similar to the standard configuration of an IPF application. The main difference is the configuration of CXF. Because the application runs within a Tomcat environment, CXF must not start its own Jetty instance. Here is the context.xml:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:camel=&quot;http://camel.apache.org/schema/spring&quot;
        xmlns:ipf=&quot;http://openehealth.org/schema/ipf-commons-core&quot;
        xsi:schemaLocation=&quot;
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://camel.apache.org/schema/spring
    http://camel.apache.org/schema/spring/camel-spring.xsd
    http://openehealth.org/schema/ipf-commons-core
    http://openehealth.org/schema/ipf-commons-core.xsd&quot;&gt;

        &lt;!-- The following imports are required to configure CXF. cxf-servlet
             is imported to configure CXF to run with servlet support. This
             allows us to use Tomcat with the CXFServlet instead of using CXF
             with a standalone Jetty server. --&gt;
        &lt;import resource=&quot;classpath:META-INF/cxf/cxf.xml&quot; /&gt;
        &lt;import resource=&quot;classpath:META-INF/cxf/cxf-servlet.xml&quot; /&gt;

        &lt;!-- Camel context and producer --&gt;
        &lt;camel:camelContext id=&quot;camelContext&quot;&gt;
            &lt;camel:jmxAgent id=&quot;agent&quot; disabled=&quot;true&quot; /&gt;
            &lt;camel:routeBuilder ref=&quot;iti4142RouteBuilder&quot;/&gt;
            &lt;camel:routeBuilder ref=&quot;iti43RouteBuilder&quot;/&gt;
            &lt;camel:routeBuilder ref=&quot;iti18RouteBuilder&quot;/&gt;
        &lt;/camel:camelContext&gt;

        &lt;ipf:globalContext id=&quot;globalContext&quot;/&gt;

        &lt;!-- Our route builders for the ITI transactions --&gt;
        &lt;bean id=&quot;iti4142RouteBuilder&quot;
            class=&quot;org.openehealth.ipf.tutorials.xds.Iti4142RouteBuilder&quot;&gt;
        &lt;/bean&gt;

        &lt;bean id=&quot;iti43RouteBuilder&quot;
            class=&quot;org.openehealth.ipf.tutorials.xds.Iti43RouteBuilder&quot;&gt;
        &lt;/bean&gt;

        &lt;bean id=&quot;iti18RouteBuilder&quot;
            class=&quot;org.openehealth.ipf.tutorials.xds.Iti18RouteBuilder&quot;&gt;
        &lt;/bean&gt;

        &lt;!-- The store that contains all the in-memory documents and their meta data --&gt;
        &lt;bean id=&quot;dataStore&quot; class=&quot;org.openehealth.ipf.tutorials.xds.DataStore&quot; /&gt;

    &lt;/beans&gt;

</pre> 
    </div> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Exposing_the_XDS_endpoints">Exposing the XDS endpoints</h4> 
   <p>To allow clients to communicate with the registry/repository, a few routes are defined that automatically expose the SOAP-based endpoints. The SOAP related details that are required by the IHE profile are completely invisible. A <tt>from(...)</tt> is all it takes. Take a look at the following snippets:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti18RouteBuilder.groovy

    public void configure() throws Exception {
            ...
            // Entry point for Stored Query
            from('xds-iti18:xds-iti18')
               ...

</pre> 
    </div> 
   </div> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti42RouteBuilder.groovy

    public void configure() throws Exception {
            ...
            // Entry point for Provide and Register Document Set
            from('xds-iti41:xds-iti41')
            ...
            // Entry point for Register Document Set
            from('xds-iti42:xds-iti42')
            ...

</pre> 
    </div> 
   </div> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti43RouteBuilder.groovy

    public void configure() throws Exception {
            ...
            // Entry point for Retrieve Document Set
            from('xds-iti43:xds-iti43')
            ...

</pre> 
    </div> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Validating_incoming_requests">Validating incoming requests</h4> 
   <p>Once the endpoints have been exposed, clients can send in requests. These requests might or might not conform to the IHE specification. It is usually a good idea to validate incoming requests before processing them.</p> 
   <p>The XDS components offer a simple validation. This is not meant to be complete, e.g. it cannot validate that a patient ID is actually known to the registry, but it performs a variety of checks that will simplify our route implementations. All routes of the demo repository perform this basic validation step right after logging the incoming request, e.g. in ITI-43:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>import static org.openehealth.ipf.platform.camel.ihe.xds.XdsCamelValidators.*

...

    // Iti43RouteBuilder.groovy
    ...
            // Entry point for Retrieve Document Set
            from('xds-iti43:xds-iti43')
                .log(log) { 'received iti43: ' + it.in.getBody(RetrieveDocumentSet.class) }
                .process(iti43RequestValidator())
</pre> 
    </div> 
   </div> 
   <p>A validation failure will throw an <tt>XDSMetaDataException</tt>. It is not necessary to put any <tt>onException</tt> handling in the route for this exception. The XDS components convert validation failures into an equivalent XDS response with the correct error code. Therefore, this exception can be thrown anywhere else in the routing.</p> 
   <p>E.g. the demo repository contains code to check for a specific patient ID used by the XDSToolKit. Because the demo does not track patients yet, it simply throws an exception if this specific patient ID is found in a request:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti4142RouteBuilder.groovy
    ...
        from('direct:checkPatientIds')
                .choice().when { it.in.body.req.submissionSet.patientId.id == '1111111' }
                    .fail(UNKNOWN_PATIENT_ID)
                ...

</pre> 
    </div> 
   </div> 
   <p>A failure is reported by throwing an <tt>XDSMetaDataException</tt> via the <tt>fail</tt> DSL extension that is implemented in <tt>RegRepModelExtension.groovy</tt>. The code snippet below shows that this is simply a shortcut to throw the exception:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // RegRepModelExtension.groovy
    ...

        static ProcessorDefinition fail(ProcessorDefinition self, message) {
            self.process { throw new XDSMetaDataException(message) }
        }

</pre> 
    </div> 
   </div> 
   <p>If any other exception is thrown in the route, the XDS components will report a general error in the failure response (either <tt>XDSRepositoryError</tt> or <tt>XDSRegistryError</tt>). Of course you can use standard exception handling from Camel to handle such cases.</p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Using_the_meta_data_classes">Using the meta data classes</h3> 
  <p>Once validated, the route starts processing the incoming message. The format of the data structure that is received in the message body is very important. By default these are instances of the raw ebXML classes. While these might be interesting for some use cases, it is often better to use classes that are closer to the XDS meta classes defined by the IHE specification.</p> 
  <p>These meta classes serve two purposes:</p> 
  <ul> 
   <li>they ensure conformance with the XDS specification</li> 
   <li>they are much easier to use than the more generic ebXML classes</li> 
  </ul> 
  <p>All route builders of the demo repository convert the ebXML bodies to the meta classes after validation. There are different ways to do this. One way is to simply use <tt>convertBodyTo</tt> which results in the body to be converted from the ebXML class to the meta data class. This is done in the ITI-43 route:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    // Entry point for Retrieve Document Set
            from('xds-iti43:xds-iti43')
                .log(log) { 'received iti43: ' + it.in.getBody(RetrieveDocumentSet.class) }
                // Validate and convert the request
                .validate().iti43Request()
                .convertBodyTo(RetrieveDocumentSet.class)

</pre> 
   </div> 
  </div> 
  <p>Another way is to retrieve the meta class instance via <tt>getBody</tt>. E.g. in the ITI-41 route builder, the input body is transformed into a map that contains the actual request object. This allows access to the request at any stage in the routing. To create the map, a transform processing is used:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    from('xds-iti41:xds-iti41')
                .log(log) { 'received iti41: ' + it.in.getBody(ProvideAndRegisterDocumentSet.class) }
                // Validate and convert the request
                .validate().iti41Request()
                .transform {
                    [ 'req': it.in.getBody(ProvideAndRegisterDocumentSet.class), 'uuidMap': [:] ]
                }
</pre> 
   </div> 
  </div> 
  <p>In contrast to <tt>convertBodyTo</tt>, getBody does not replace the body of the message. Check out the log step at the beginning of the route. It uses <tt>getBody</tt> to retrieve the meta class. The good thing about these classes is that they have meaningful equals, hashCode and toString implementations.</p> 
  <p>The logging step converts the ebXML class on-the-fly and uses its <tt>toString</tt> method to get a nice textual representation. If <tt>convertBodyTo</tt> had been used, the validation step would fail, because it expects an ebXML class in the message body.</p> 
  <p>Lets look at some typical use cases that require access to the meta classes.</p> 
  <div class="section"> 
   <h4 id="Evaluating_the_query_type">Evaluating the query type</h4> 
   <p>The next code snippet shows the dispatching of an ITI-18 message based on the stored query type.</p> 
   <p>This uses <a class="externalLink" href="https://camel.apache.org/content-based-router.html">content based routing</a> via <tt>choice()</tt> to call sub routes that perform the corresponding query logic. The <tt>queryType</tt> method is a simple shortcut to get the query type property from the request message.</p> 
   <p>If a non-supported query type is found an exception is thrown using the <tt>fail</tt> processor. All query types that are defined by the IHE specification are listed in the enum <tt>org.openehealth.ipf.platform.camel.ihe.xds.commons.requests.query.QueryType</tt>.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti18RouteBuilder

    public void configure() throws Exception {
            ...

            from('xds-iti18:xds-iti18')
                ...
                // Dispatch to the correct query implementation
                .choice()
                    .when { queryType(it) == FIND_DOCUMENTS }.to('direct:findDocs')
                    .when { queryType(it) == FIND_SUBMISSION_SETS }.to('direct:findSets')
                    .when { queryType(it) == FIND_FOLDERS }.to('direct:findFolders')
                    .when { queryType(it) == GET_SUBMISSION_SET_AND_CONTENTS }.to('direct:getSetAndContents')
                    .when { queryType(it) == GET_DOCUMENTS }.to('direct:getDocs')
                    .when { queryType(it) == GET_FOLDER_AND_CONTENTS }.to('direct:getFolderAndContents')
                    .when { queryType(it) == GET_FOLDERS }.to('direct:getFolders')
                    .when { queryType(it) == GET_SUBMISSION_SETS }.to('direct:getSets')
                    .when { queryType(it) == GET_ASSOCIATIONS }.to('direct:getAssocs')
                    .when { queryType(it) == GET_DOCUMENTS_AND_ASSOCIATIONS }.to('direct:getDocsAndAssocs')
                    .when { queryType(it) == GET_FOLDERS_FOR_DOCUMENT }.to('direct:getFoldersForDoc')
                    .when { queryType(it) == GET_RELATED_DOCUMENTS }.to('direct:getRelatedDocs')
                    .otherwise().fail(ErrorCode.UNKNOWN_STORED_QUERY)
                .end()

             ...
        }

        def queryType(exchange) { exchange.in.body.req.query.type }

</pre> 
    </div> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Splitting_for_individual_entry_processing">Splitting for individual entry processing</h4> 
   <p>Many XDS transactions work with sets of entries, e.g. upload and download are using multiple documents instead of just one. Using a splitter you can break down the request message into its individual entries and process them individually.</p> 
   <p>In the demo repository this is done in many cases. The next snippet of the ITI-43 route shows how to retrieve a document set by retrieving each document from the store one at a time. Using <tt>split</tt>, the actual splitting of the message is done by taking the list of documents contained in the meta class. The splitter aggregates a result list using the retrieved documents. This list is put into the message body after the splitting functionality has finished processing (indicated by end()).</p> 
   <p>The entries of the list are the result of the processing of retrieve, which is a custom DSL element that calls <tt>DataStore.get()</tt> to get the contents of the document.</p> 
   <p>Finally, the message is transformed, putting the aggregated list into the meta class for the response:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    // Iti43RouteBuilder.groovy
    ...
            // Entry point for Retrieve Document Set
            from('xds-iti43:xds-iti43')
                .log(log) { 'received iti43: ' + it.in.getBody(RetrieveDocumentSet.class) }
                // Validate and convert the request
                .process(iti43RequestValidator())
                .convertBodyTo(RetrieveDocumentSet.class)

                // Retrieve each requested document and aggregate them in a list
                .split { it.in.body.documents }
                    .aggregationStrategy(new RetrievedDocumentAggregator())
                    .retrieve()
                    .end()
                // Create success response
                .transform {
                    new RetrievedDocumentSet(Status.SUCCESS, it.in.body)
                }
    ...

        private class RetrievedDocumentAggregator extends AbstractListAggregationStrategy&lt;RetrievedDocument&gt; {

            @Override
            RetrievedDocument getValue(Exchange exchange) {
                exchange.in.getBody(RetrievedDocument.class)
            }
        }

</pre> 
    </div> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Secure_Transport">Secure Transport</h3> 
  <p>Using HTTPS instead of HTTP requires very little work. In fact, for a registry/repository it does not require anything related to IPF. Simply configure Tomcat to use secure transport for the web services.</p> 
  <p>With the embedded Tomcat class of the XDS test package, this is only a few lines of code:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    // Server.groovy
    ...
        servletServer.secure = args.length == 1 &amp;&amp; args[0].equals('secure')
            servletServer.keystoreFile = 'keystore'
            servletServer.keystorePass = 'changeit'
            servletServer.truststoreFile = 'keystore'
            servletServer.truststorePass = 'changeit'
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="ATNA_Auditing">ATNA Auditing</h3> 
  <p>By default auditing is turned on by all endpoints. The configuration of the syslog server that receives auditing messages can be found in Server.groovy:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    // Server.groovy
    ...
        AuditorModuleContext.context.config.auditRepositoryHost = 'localhost'
        AuditorModuleContext.context.config.auditRepositoryPort = SYSLOG_PORT
    ...
</pre> 
   </div> 
  </div> 
  <p>Auditing messages will always be send. Because they are send unreliably via the UDP protocol (this is the default), the XDS components “do not care” if there is actually a syslog server running at the specified host and port. If you want to see the audit messages that the demo repository logs, you can install a syslog server at localhost using the standard syslog port 514 or you can change the settings <tt>Server.groovy</tt> to match your setup.</p> 
  <p>If you want to disable auditing you can do so by changing the endpoint configurations, e.g. for ITI-18:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    from('xds-iti18:xds-iti18?audit=false')
    ...
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Summary">Summary</h3> 
  <p>In this tutorial, we went through some relevant code snippets of the demo XDS registry and repository.</p> 
  <p>The source code for this tutorial is located in the <a class="externalLink" href="https://github.com/oehf/ipf/tree/master/tutorials/xds">ipf-tutorials-xds</a> module.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#XDS_demo_repository" title="XDS demo repository">XDS demo repository <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Overview" title="Overview">Overview</a>
		<li class="dropdown"><a href="#IPF_XDS_related_code_snippets" title="IPF XDS related code snippets">IPF XDS related code snippets <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Basic_Configuration" title="Basic Configuration">Basic Configuration</a>
		<li><a href="#Exposing_the_XDS_endpoints" title="Exposing the XDS endpoints">Exposing the XDS endpoints</a>
		<li><a href="#Validating_incoming_requests" title="Validating incoming requests">Validating incoming requests</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Using_the_meta_data_classes" title="Using the meta data classes">Using the meta data classes <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Evaluating_the_query_type" title="Evaluating the query type">Evaluating the query type</a>
		<li><a href="#Splitting_for_individual_entry_processing" title="Splitting for individual entry processing">Splitting for individual entry processing</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Secure_Transport" title="Secure Transport">Secure Transport</a>
		<li><a href="#ATNA_Auditing" title="ATNA Auditing">ATNA Auditing</a>
		<li><a href="#Summary" title="Summary">Summary</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
						<li class="nav-header">Main</li>
						<li >
							<a href="../ipf-tutorials/" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../ipf-tutorials/release-notes.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Download</li>
						<li >
							<a href="../ipf-tutorials/skin/index.html#Usage" title="Download">Download</a>
						</li>
						<li >
							<a href="../ipf-tutorials/license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../ipf-tutorials/development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-ihe/index.html" title="eHealth Integration Profiles">eHealth Integration Profiles</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../ipf-tutorials/dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven documentation</li>
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li class="active">
							<a href="#" title="About">About</a>
						</li>
						<li >
							<a href="project-summary.html" title="Summary">Summary</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
						<li >
							<a href="dependencies.html" title="Dependencies">Dependencies</a>
						</li>
						<li >
							<a href="license.html" title="Licenses">Licenses</a>
						</li>
						<li >
							<a href="mail-lists.html" title="Mailing Lists">Mailing Lists</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source Code Management">Source Code Management</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="/js/lightbox.min.js"></script>
	<script src="/js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="/js/reflow-skin.js"></script>

	</body>
</html>
