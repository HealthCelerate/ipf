
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>HL7 v2 interactive response continuation in MLLP-based IPF IHE components | ipf-platform-camel-ihe-mllp</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-interactivecontinuation project-ipf-platform-camel-ihe-mllp" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="HL7_v2_interactive_response_continuation_in_MLLP-based_IPF_IHE_components">HL7 v2 interactive response continuation in MLLP-based IPF IHE components</h2>
 </div> 
 <p>This feature corresponds to Section 5.6.3 (Interactive continuation of response messages) of the HL7 v2.5 specification, is supported on both producer and consumer sides, and controlled by the following endpoint URI parameters:</p> 
 <div class="section"> 
  <h3 id="Parameters">Parameters</h3> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th align="left">Parameter name </th> 
     <th align="left">Type </th> 
     <th align="left">Default value </th> 
     <th align="left">Short description </th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td align="left"><tt>supportInteractiveContinuation</tt> </td> 
     <td align="left">boolean </td> 
     <td align="left">false </td> 
     <td align="left">whether interactive message continuation should be supported by the given endpoint</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><tt>interactiveContinuationDefaultThreshold</tt> </td> 
     <td align="left">int </td> 
     <td align="left">-1 </td> 
     <td align="left">default threshold (maximal count of data records per message) for interactive message continuation. Relevant on consumer side only, and only when the field <tt>RCP-2-1</tt> of the request message does not contain a parseable integer value. Values smaller than 1 lead to no continuation</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><tt>interactiveContinuationStorage</tt> </td> 
     <td align="left">String </td> 
     <td align="left">n/a </td> 
     <td align="left">Spring bean name of a storage for interactive continuation chains (relevant on consumer side only)</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><tt>autoCancel</tt> </td> 
     <td align="left">boolean </td> 
     <td align="left">false </td> 
     <td align="left">whether a “continuation cancel” message should be automatically sent to the server when the producer receives last data fragment. Relevant on producer side only</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>As stated in the above table, support for interactive continuation can be enabled for an endpoint by setting its URL parameter <tt>supportInteractiveContinuation</tt> to <tt>true</tt>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Behavior">Behavior</h3> 
  <p>Interactive continuation is like <a href="unsolicitedFragmentation.html">unsolicited request message fragmentation</a>, but relates to response messages instead of request messages, and uses data records count instead of segments count as the message splitting criterion (HL7 specification declares some other counts — e.g. those of lines, characters, or pages — to be usable as splitting criteria as well, but they are not supported by the IPF).</p> 
  <p>What a “data record” does actually mean thereby, is transaction-dependent — for example, in PDQ (ITI-21), each data record corresponds to a <tt>QUERY_RESPONSE</tt> group which consists of segments <tt>PID</tt>, <tt>PD1</tt>, <tt>NK1</tt>, and <tt>QRI</tt> (data record definitions for ITI-21 and ITI-22 are available in the IPF out-of-the-box).</p> 
  <div class="section"> 
   <h4 id="Consumer">Consumer</h4> 
   <p>When interactive continuation is enabled, a consumer will apply transaction-specific rules to split the messages into fragments, using threshold value from the field <tt>RCP-2-1</tt>, provided that <tt>RCP-2-2</tt> is equal to “RD”. Each fragment can be requested more than once, in arbitrary order.</p> 
   <p>If the mentioned threshold field is not filled in the expected way, the value of the URL parameter <tt>interactiveContinuationDefaultThreshold</tt> will be used. When this parameter is not configured as well or its value is less than 1, no message splitting will be performed.</p> 
   <p>Interaction steps performed by the consumer are shown on the diagram below:</p> 
   <p><img src="images/conti-consumer-ic.png" alt="Consumer Interactive Continuation" /></p> 
   <p>Fragments are stored internally, whereby the user must provide a storage via the <tt>interactiveContinuationStorage</tt> URI parameter of the consumer endpoint. This bean must implement the interface <a href="../apidocs/org/openehealth/ipf/platform/camel/ihe/mllp/core/InteractiveContinuationStorage.html"><tt>org.openehealth.ipf.platform.camel.ihe.mllp.core.InteractiveContinuationStorage</tt></a>. An Ehcache-based implementation is provided by the IPF.</p> 
   <p>Here is an example of how to configure the Spring context descriptor, supposed that “interactiveContinuationCache” is defined in Ehcache configuration file:</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>    &lt;bean id=&quot;ehcacheManager&quot; class=&quot;net.sf.ehcache.CacheManager&quot; factory-method=&quot;create&quot; /&gt;

    &lt;bean id=&quot;myICStorage&quot;
          class=&quot;org.openehealth.ipf.platform.camel.ihe.mllp.core.EhcacheInteractiveConfigurationStorage&quot;&gt;
        &lt;constructor-arg&gt;
            &lt;bean factory-bean=&quot;ehcacheManager&quot; factory-method=&quot;getCache&quot;&gt;
                &lt;constructor-arg value=&quot;interactiveContinuationCache&quot; /&gt;
            &lt;/bean&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;
</pre> 
    </div> 
   </div> 
   <p>The consumer endpoint URI can then contain parameters <tt>&quot;&amp;supportInteractiveContinuation=true&amp;interactiveContinuationStorage=#myICStorage&quot;</tt>.</p> 
   <p>Obsolete fragment chains can be removed from the storage either by means of a corresponding cancel message <tt>QCN^J01</tt> sent by the client (as usual, such messages are automatically served by the IPF) or by proprietary mechanisms of the storage, if available.</p> 
  </div> 
  <div class="section"> 
   <h4 id="Producer">Producer</h4> 
   <p>When an MLLP-based IPF IHE producer with enabled interactive continuation support recognizes that the response message it just received is actually the first fragment of an interactive chain, it automatically adds its segment DSC to the initial request message and sends the latter again, as prescribed by the HL7 specification, requesting the next fragment in that way.</p> 
   <p>This step will be repeated for all subsequent fragments until the last fragment of the chain has arrived. After that, the producer joins all collected data records together (using the same transaction-specific rules as the consumer used) and delivers the cumulative response to the caller.</p> 
   <p>Optionally — i.e. when the endpoint URI parameter <tt>autoCancel</tt> is set to true — a “continuation cancel” message will be sent in order to tell the data provider that the it can safely release its resources. The diagram below shows these interaction steps:</p> 
   <p><img src="images/conti-producer-ic.png" alt="Producer Interactive Continuation" /></p> 
   <p>All unexpected fragments will be passed through to the route without changes. This rule applies to cancel messages which relate to non-existent interactive chains (represented by their query tags) as well.</p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Combining_unsolicited_request_fragmentation_with_interactive_response_continuation">Combining unsolicited request fragmentation with interactive response continuation</h3> 
  <p>Simultaneous activation of unsolicited message fragmentation and interactive message continuation can be problematic, because each of them makes use of the same fields in the segment <tt>DSC</tt>. For example, when a request message was sent using unsolicited fragmentation, and the response represents an interactive continuation fragment, it will be impossible to send the request for the second response fragment using unsolicited fragmentation, because <tt>DSC-1</tt> will contain a non-empty value.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#HL7_v2_interactive_response_continuation_in_MLLP-based_IPF_IHE_components" title="HL7 v2 interactive response continuation in MLLP-based IPF IHE components">HL7 v2 interactive response continuation in MLLP-based IPF IHE components <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Parameters" title="Parameters">Parameters</a>
		<li class="dropdown"><a href="#Behavior" title="Behavior">Behavior <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Consumer" title="Consumer">Consumer</a>
		<li><a href="#Producer" title="Producer">Producer</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Combining_unsolicited_request_fragmentation_with_interactive_response_continuation" title="Combining unsolicited request fragmentation with interactive response continuation">Combining unsolicited request fragmentation with interactive response continuation</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Submodules</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
