
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Support for the Asynchronous Web Service Exchange option in IPF eHealth Components | ipf-platform-camel-ihe-ws</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-async project-ipf-platform-camel-ihe-ws" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Support_for_the_Asynchronous_Web_Service_Exchange_option_in_IPF_eHealth_Components">Support for the “Asynchronous Web Service Exchange” option in IPF eHealth Components</h2>
 </div> 
 <p>The <i>Asynchronous Web Service Exchange</i> option is provided for cross-community IHE integration profiles. It consists in the usage of the <tt>ReplyTo</tt> SOAP header defined in the <a class="externalLink" href="https://www.w3.org/Submission/ws-addressing/">WS-Addressing</a> specification.</p> 
 <p>When a request message specifies this header and it contains an URI not equal to the predefined “default” and “none” values, the service will send the response to this URL instead of returning the response to the original requestor.</p> 
 <p>The IPF provides support for this option. User intervention is necessary on the client side only (i.e. for sending requests and receiving asynchronous responses), because the whole server-side magic is provided out-of-box by the <a class="externalLink" href="https://cxf.apache.org/">Apache CXF Framework</a>.</p> 
 <p>To make an asynchronous call, three additional steps must be performed:</p> 
 <ul> 
  <li>arrange a message correlator;</li> 
  <li>arrange a special receiver endpoint for asynchronous responses;</li> 
  <li>store URI of this endpoint in the corresponding header of outgoing request messages.</li> 
 </ul> 
 <p>These steps are described in corresponding sections below.</p> 
 <div class="section"> 
  <h3 id="Message_correlator">Message correlator</h3> 
  <p>The purpose of the message correlator is to provide a mechanism for the attribution of asynchronous responses to the corresponding requests (which is necessary in particular for ATNA auditing). Moreover, it provides the possibility to associate a user-defined key to a group of asynchronous requests in order to efficiently aggregate responses.</p> 
  <p>The user has to define an instance of a class which implements the <a href="../apidocs/org/openehealth/ipf/commons/ihe/ws/correlation/AsynchronyCorrelator.html"><tt>org.openehealth.ipf.commons.ihe.ws.correlation.AsynchronyCorrelator</tt></a> interface. An <a class="externalLink" href="http://ehcache.org/">Ehcache</a>-based correlator implementation is provided by the IPF out-of-box, so in the simplest case the instantiation will look like (supposed that <tt>wsCorrelationCache</tt> is defined in Ehcache descriptor):</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    &lt;bean id=&quot;ehcacheManager&quot; class=&quot;net.sf.ehcache.CacheManager&quot; factory-method=&quot;create&quot; /&gt;

    &lt;bean id=&quot;correlator&quot;
          class=&quot;org.openehealth.ipf.commons.ihe.ws.correlation.EhcacheAsynchronyCorrelator&quot;&gt;
        &lt;constructor-arg&gt;
            &lt;bean factory-bean=&quot;ehcacheManager&quot; factory-method=&quot;getCache&quot;&gt;
                &lt;constructor-arg value=&quot;wsCorrelationCache&quot; /&gt;
            &lt;/bean&gt;
        &lt;/constructor-arg&gt;
    &lt;/bean&gt;


</pre> 
   </div> 
  </div> 
  <p>When a remote service fails to send a response, orphan data items remain in the correlator. The Ehcache-based implementation is able to handle this issue, user-defined impementations should take care of it by theirselves.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Receiver_Endpoint">Receiver Endpoint</h3> 
  <p>A special endpoint should be arranged <b>on the client side</b> for serving asynchronous response messages. Component part of the endpoint URI corresponds to the transaction, with the suffix “-async-response”, e.g. for an XCPD Initiating Gateway (ITI-55 client):</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    from(&quot;xcpd-iti55-async-response:iti55service-response?correlator=#correlator&quot;)
        .process(iti55ResponseValidator())
        ...

</pre> 
   </div> 
  </div> 
  <p>The mandatory paramater <tt>correlator</tt> must contain a reference to the correlator bean as described above.</p> 
  <p>Per default, all messages arrived on this endpoint will be processed using <tt>InOnly</tt> exchange pattern.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Sending_asynchronous_requests">Sending asynchronous requests</h3> 
  <p>To send a request in asynchronous mode, the client has to put the URL of the response receiver endpoint into the Camel message header <tt>AbstractWsEndpoint#WSA_REPLYTO_HEADER_NAME</tt>. Note that this URL must be a plain HTTP(s) one, not a IPF endpoint URI. Moreover, the correlator bean should be referenced in the producer endpoint URI.:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    from(&quot;direct:foobar&quot;)
        .setHeader(AbstractWsEndpoint.WSA_REPLYTO_HEADER_NAME,
                   constant(&quot;http://localhost:8889/iti55service-response&quot;))
        .to(&quot;xcpd-iti55://somehost.uri/XCPDRespondingGateway?correlator=#correlator&quot;)

</pre> 
   </div> 
  </div> 
  <p>In this case, the <tt>.to(&quot;xcpd...&quot;)</tt> statement will return immediately (using the <tt>InOnly</tt> exchange pattern), and the response will be retrieved asynchronously over the separate receiver endpoint.</p> 
  <p>In the same way, a user-defined correlation key can be set via the request message header <tt>AbstractWsEndpoint#CORRELATION_KEY_HEADER_NAME</tt>. This header will be automatically restored in the asynchronous response message, when the latter arrives.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#Support_for_the_Asynchronous_Web_Service_Exchange_option_in_IPF_eHealth_Components" title="Support for the “Asynchronous Web Service Exchange” option in IPF eHealth Components">Support for the “Asynchronous Web Service Exchange” option in IPF eHealth Components <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Message_correlator" title="Message correlator">Message correlator</a>
		<li><a href="#Receiver_Endpoint" title="Receiver Endpoint">Receiver Endpoint</a>
		<li><a href="#Sending_asynchronous_requests" title="Sending asynchronous requests">Sending asynchronous requests</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Submodules</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
