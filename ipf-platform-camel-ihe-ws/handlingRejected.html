
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-03-09
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Handling messages rejected by the Web Service endpoint | ipf-platform-camel-ihe-ws</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/docs.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
	</head>

	<body class="page-handlingrejected project-ipf-platform-camel-ihe-ws" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=".."><span class="color-highlight">IPF</span> Open eHealth Integration Platform</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a></li>
							<li ><a href="https://github.com/oehf/ipf" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a></li>
									<li ><a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a></li>
									<li ><a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a></li>
									<li ><a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a></li>
									<li ><a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a></li>
									<li ><a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a></li>
									<li ><a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a></li>
									<li ><a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a></li>
									<li ><a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a></li>
									<li ><a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a></li>
									<li ><a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><br/><span class="color-highlight">IPF</span> Open eHealth Integration Platform</h1></a>
					<p class="lead">eHealth standards on steroids</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Handling_messages_rejected_by_the_Web_Service_endpoint">Handling messages rejected by the Web Service endpoint</h2>
 </div> 
 <p>Requests of Web Service-based transactions are automatically rejected, when at least one of the following applies:</p> 
 <ul> 
  <li>the request (or its first part in case of multi-part HTTP messages) does not contain a well-formed SOAP Envelope</li> 
  <li>SOAP Body content is of incorrect type (e.g. plain text instead of ebXML for XDS/XCA)</li> 
  <li>the payload is not accepted by the corresponding IPF component (e.g. a HL7v2 request denotes wrong message type in MSH-9 or wrong HL7 version in MSH-12).</li> 
 </ul> 
 <p>Moreover, the same “rejection” effect can occur in HL7v2-based Web Service transactions — an HL7v2 NAK with acknowledgement code ‘AR’ or ‘CR’ will be automatically generated when:</p> 
 <ul> 
  <li>the Camel route has not delivered anything that could be converted into HL7v2 response message</li> 
  <li>the response message has wrong values in MSH-9 (message type) and MSH-12 (HL7 version).</li> 
 </ul> 
 <div class="section"> 
  <h3 id="Problem">Problem</h3> 
  <p>Rejected request messages will not reach the Camel route, thus the application developer will not have any chance to handle them and even to be notified about them:</p> 
  <p><img src="images/rejection-before.png" alt="Message Rejection" /></p> 
 </div> 
 <div class="section"> 
  <h3 id="Solution">Solution</h3> 
  <p>It is possible to configure a user-defined strategy (i.e. an implementation of the interface <a href="../apidocs/org/openehealth/ipf/commons/ihe/ws/cxf/WsRejectionHandlingStrategy.html"><tt>WsRejectionHandlingStrategy</tt></a>) which handles all rejected messages.</p> 
  <p>IPF provides two alternative abstract base classes for such strategies — a generic <a href="../apidocs/org/openehealth/ipf/commons/ihe/ws/cxf/AbstractWsRejectionHandlingStrategy.html"><tt>AbstractWsRejectionHandlingStrategy</tt></a> and a HL7v2-over-WS specific <a href="../apidocs/org/openehealth/ipf/platform/camel/ihe/hl7v2ws/AbstractHl7v2WsRejectionHandlingStrategy.html"><tt>AbstractHl7v2WsRejectionHandlingStrategy</tt></a>. They differ in determination logic of whether the given interaction (represented by a CXF exchange) can be considered as failed.</p> 
  <p>On every message rejection, the provided strategy instance will receive a <a class="externalLink" href="https://cxf.apache.org/javadoc/latest/org/apache/cxf/message/Exchange.html">CXF exchange</a> containing the request SOAP message in various formats, the automatically generated response message (SOAP fault or HL7v2 NAK), and the whole context information:</p> 
  <p><img src="images/rejection-after.png" alt="Message Rejection" /></p> 
  <p>One of available SOAP message formats thereby is <a href="../apidocs/org/openehealth/ipf/commons/ihe/ws/cxf/payload/StringPayloadHolder.html"><tt>StringPayloadHolder</tt></a>. Before the SOAP Body has been parsed, this object holds the whole HTTP payload (possibly as MIME, i.e. with all attachments); after that, only SOAP payload is present for performance and memory saving reasons.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Example">Example</h3> 
  <p>Provide a derived implementation in form of a Spring bean:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    &lt;bean id=&quot;myRejectionHandlingStrategy&quot;
        class=&quot;org.openehealth.ipf.platform.camel.ihe.hl7v2ws.pcd01.MyRejectionHandlingStrategy&quot; /&gt;
</pre> 
   </div> 
  </div> 
  <p>Reference it in the URI of the corresponding consumer endpoint:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>    from(&quot;pcd-pcd01:myEndpoint?rejectionHandlingStrategy=#myRejectionHandlingStrategy&quot;)
      ...
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Important_Hints">Important Hints</h3> 
  <p>Implementors of the rejection handlers must be aware that some objects available from the CXF exchange instances — particularly Servlet contexts and HTTP sessions — should be handled very carefully. In particular, it should be assured that the rejection handlers do not contain any functionality (e.g. some type of queueing or durable collecting of received CXF exchanges and their elements) that could restrict resource management activities of the Java VM and the operating system.</p> 
  <p>Such restrictions may lead not only to system performance and scalability penalties, but also foster DDoS attacks, as hackers will be able to exhaust resources of a system simply by sending a bunch of invalid requests to it.</p> 
  <p>Furthermore, note that the rejection handling mechanism is <b>not</b> intended for changing of message content and/or message flow.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#Handling_messages_rejected_by_the_Web_Service_endpoint" title="Handling messages rejected by the Web Service endpoint">Handling messages rejected by the Web Service endpoint <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Problem" title="Problem">Problem</a>
		<li><a href="#Solution" title="Solution">Solution</a>
		<li><a href="#Example" title="Example">Example</a>
		<li><a href="#Important_Hints" title="Important Hints">Important Hints</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="../changes-report.html" title="Release notes">Release notes</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Download</li>
						<li >
							<a href="https://github.com/oehf/ipf" title="Download" class="externalLink">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../development.html" title="Development">Development</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/issues/" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/oehf/ipf/" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li class="nav-header">Submodules</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../ipf-platform-camel-ihe/index.html" title="eHealth Integration Profile">eHealth Integration Profile</a>
						</li>
						<li >
							<a href="../ipf-modules-hl7/index.html" title="HL7v2 Message Processing">HL7v2 Message Processing</a>
						</li>
						<li >
							<a href="../ipf-commons-ihe-hl7v3/index.html" title="HL7 Message translation">HL7 Message translation</a>
						</li>
						<li >
							<a href="../ipf-modules-cda/index.html" title="CDA Support">CDA Support</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-core/index.html" title="Camel Groovy layer">Camel Groovy layer</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-hl7/index.html" title="Camel HL7 processing">Camel HL7 processing</a>
						</li>
						<li >
							<a href="../ipf-platform-camel-cda/index.html" title="Camel CDA processing">Camel CDA processing</a>
						</li>
						<li >
							<a href="../ipf-commons-map/index.html" title="Code System Mapping">Code System Mapping</a>
						</li>
						<li >
							<a href="../dynamic.html" title="Dynamic Registration of IPF Features">Dynamic Registration of IPF Features</a>
						</li>
						<li >
							<a href="../ipf-osgi-karaf/index.html" title="OSGi Support">OSGi Support</a>
						</li>
						<li >
							<a href="../ipf-tutorials/index.html" title="Tutorials">Tutorials</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017 <a href="http://www.openehealth.org/">Open eHealth Foundation</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 3.2-SNAPSHOT. </span><span class="publishDate">Last Published: 2017-03-09. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
